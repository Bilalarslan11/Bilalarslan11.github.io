(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1],{388:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__N_SSG:()=>i,default:()=>d});var a=r(7876),s=r(1411),l=r(596),o=r(3995),n=r(4107),c=r(4232),i=!0;let d=e=>{let{initialGames:t,initialError:r,builtAt:i}=e,[d,u]=(0,c.useState)(!1),m=()=>u(!1),[h]=(0,c.useState)(t),[g,p]=(0,c.useState)([]),[f,v]=(0,c.useState)(t),[x]=(0,c.useState)(null!=r?r:null),[y,w]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{if(x)return;let e=!1;return(async()=>{try{w(!0);let t=await fetch("https://api.zehai.dk/games/top-rated",{cache:"no-store",mode:"cors",credentials:"omit"});if(!t.ok)throw Error("live fetch ".concat(t.status));let r=await t.json(),a=r;if(!Array.isArray(a)){let e="object"==typeof r&&null!==r?r:null;a=Array.isArray(null==e?void 0:e.games)?e.games:[]}let s=a.map((e,t)=>{var r,a,s,l,o;let n,c="/gamepictures/placeholder.png";if(0===t&&(console.log("First game from API:",e),console.log("Cover object:",e.cover),console.log("Cover type:",typeof e.cover)),"string"==typeof e.cover?n=e.cover:e.cover&&"object"==typeof e.cover&&"url"in e.cover&&(n=e.cover.url),0===t&&console.log("Cover URL value:",n),n&&""!==n.trim()){let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920;if(!e||"string"!=typeof e||""===e.trim())return e||"";let r=e.startsWith("//")?"https:"+e:e;if(r.includes("images.igdb.com/igdb/image/upload/"))return r.replace("/t_thumb/","/t_cover_big/");try{let e=new URL(r);return e.searchParams.set("width",String(t)),e.searchParams.set("quality","90"),e.searchParams.set("dpr","2"),e.toString()}catch(a){let e=r.includes("?")?"&":"?";return"".concat(r).concat(e,"width=").concat(t,"&quality=90&dpr=2")}}(n);e&&""!==e.trim()?c=e:0===t&&console.warn("upgradeImageUrl returned invalid URL:",e)}else 0===t&&console.warn("Game missing cover URL:",e);return{id:null!=(r=e.id)?r:t+1,rank:t+1,title:null!=(a=e.name)?a:"Untitled",producer:"",hours:Math.round(null!=(s=e.rating)?s:0),image:c,rating:Number(null!=(o=null!=(l=e.weightedRating)?l:e.rating)?o:0),console:"",year:"",genre:"",company:"",credits:"",hundredPercent:"",dlc:""}});e||v(s)}catch(t){e||console.warn("Live update failed",t)}finally{e||w(!1)}})(),()=>{e=!0}},[x]),(0,c.useEffect)(()=>{try{let e=(0,n.Rq)();p(e)}catch(e){console.error("Error loading game statuses:",e)}},[]),(0,a.jsxs)(o.A,{nav:d,openNav:()=>u(!0),closeNav:m,scrollToSection:()=>m(),children:[x&&(0,a.jsx)("div",{className:"w-[90%] max-w-[112rem] mx-auto mb-6",role:"alert",children:(0,a.jsxs)("div",{className:"p-4 rounded border-2 border-theme-secondary bg-theme-darker",children:[(0,a.jsx)("p",{className:"text-theme-secondary font-bold mb-2",children:"Failed to load games"}),(0,a.jsx)("p",{className:"text-theme-text text-sm break-words mb-4",children:x}),(0,a.jsx)("p",{className:"text-theme-text text-xs opacity-70",children:"(Static build fetch failed)"})]})}),!x&&h.length>0&&(0,a.jsx)(s.A,{games:h,onFilterChange:e=>{v(e)}}),!x&&(0,a.jsx)(l.A,{games:f,gameStatuses:g,onStatusUpdate:()=>{try{let e=(0,n.Rq)();p(e)}catch(e){console.error("Error refreshing game statuses:",e)}},valueLabel:"/ 100"}),!x&&(0,a.jsx)("div",{className:"w-[90%] max-w-[112rem] mx-auto mt-4 text-right text-[10px] text-gray-400",children:(0,a.jsxs)("span",{children:["Built at ",new Date(i).toLocaleString()," \xb7"," ",y?"Refreshingâ€¦":"Live order loaded"]})})]})}},1572:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/games",function(){return r(388)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[79,230,196,636,593,792],()=>t(1572)),_N_E=e.O()}]);